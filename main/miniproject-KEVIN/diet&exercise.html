<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Recommendations | Blood Analysis</title>
    <style>
        :root {
            --primary-color: #62a6b8;
            --secondary-color: #3b637d;
            --light-bg: #f5f9fc;
            --border-color: #e0e7ee;
            --warning-color: #e67e22;
            --danger-color: #e74c3c;
            --success-color: #2ecc71;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: var(--light-bg);
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header-title p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .header-actions button {
            background-color: white;
            color: var(--primary-color);
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
            transition: all 0.3s ease;
        }
        
        .header-actions button:hover {
            background-color: #f0f0f0;
            transform: translateY(-2px);
        }
        
        .tabs {
            display: flex;
            background-color: #f0f7ff;
            border-bottom: 1px solid var(--border-color);
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--secondary-color);
            border-bottom: 3px solid transparent;
        }
        
        .tab:hover {
            background-color: rgba(96, 165, 184, 0.1);
        }
        
        .tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-title {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .parameter-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary-color);
        }
        
        .parameter-card h3 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .parameter-status {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            margin-left: 10px;
        }
        
        .status-normal {
            background-color: #e1f5e5;
            color: #2ecc71;
        }
        
        .status-low {
            background-color: #fdebd0;
            color: #e67e22;
        }
        
        .status-high {
            background-color: #f5d9d7;
            color: #e74c3c;
        }
        
        .parameter-card.anemia {
            border-left-color: #e67e22;
        }
        
        .parameter-card.diabetes {
            border-left-color: #e74c3c;
        }
        
        .parameter-card.inflammation {
            border-left-color: #9b59b6;
        }
        
        .food-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .food-item {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            border-left: 3px solid var(--primary-color);
        }
        
        .food-icon {
            font-size: 24px;
            margin-right: 15px;
        }
        
        .food-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .food-description {
            font-size: 13px;
            color: #666;
        }
        
        .guidelines {
            background-color: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .exercise-recommendations {
            margin-top: 30px;
        }
        
        .exercise-item {
            display: flex;
            align-items: center;
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .exercise-item-icon {
            font-size: 24px;
            margin-right: 15px;
            width: 40px;
            height: 40px;
            background-color: #f0f7ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .exercise-item-content {
            flex: 1;
        }
        
        .exercise-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .exercise-description {
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .exercise-duration {
            font-size: 12px;
            color: var(--secondary-color);
        }
        
        .meal-plan-day {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .meal-plan-day h4 {
            margin-bottom: 15px;
            color: var(--secondary-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .meal-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #eee;
        }
        
        .meal-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }
        
        .meal-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .meal-description {
            font-size: 14px;
            color: #555;
        }
        
        .ai-recommendation {
            background-color: #f0f7ff;
            border-left: 5px solid #62a6b8;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: #62a6b8;
            animation: spin 1s ease-in-out infinite;
            vertical-align: middle;
            margin-left: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .meal-nutrition {
            font-size: 12px;
            color: #3b637d;
            font-style: italic;
            margin-top: 4px;
        }
        
        .badge-ai {
            display: inline-block;
            background-color: #62a6b8;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 8px;
            vertical-align: middle;
        }
        
        @media print {
            body {
                background-color: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
            }
            
            .header-actions, .tabs {
                display: none;
            }
            
            .tab-content {
                display: block !important;
            }
        }
        
        @media (max-width: 768px) {
            .food-list {
                grid-template-columns: 1fr;
            }
            
            .header-title h1 {
                font-size: 20px;
            }
            
            .header-actions button {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .tab-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-title">
                <h1>Health Recommendations</h1>
                <p>Based on your blood test analysis</p>
            </div>
            <div class="header-actions">
                <button id="goBackButton">Go Back</button>
                <button id="printButton">Print Report</button>
            </div>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="overview">Overview</div>
            <div class="tab" data-tab="diet">Diet</div>
            <div class="tab" data-tab="exercise">Exercise</div>
            <div class="tab" data-tab="mealplan">Meal Plan</div>
        </div>
        
        <div id="overview" class="tab-content active">
            <div id="patientSummary">
                <!-- Summary content will be populated here -->
            </div>
        </div>
        
        <div id="diet" class="tab-content">
            <h3 class="section-title">Dietary Recommendations</h3>
            <div id="dietSummary">
                <!-- Diet summary will be populated here -->
            </div>
            
            <h4 class="section-title">Foods to Include</h4>
            <div id="recommendedFoods" class="food-list">
                <!-- Recommended foods will be populated here -->
            </div>
            
            <h4 class="section-title">Foods to Limit</h4>
            <div id="limitFoods" class="food-list">
                <!-- Foods to limit will be populated here -->
            </div>
            
            <div class="guidelines">
                <h4>General Nutrition Guidelines</h4>
                <ul id="nutritionGuidelines">
                    <!-- Guidelines will be populated here -->
                </ul>
            </div>
        </div>
        
        <div id="exercise" class="tab-content">
            <h3 class="section-title">Exercise Recommendations</h3>
            <div id="exerciseSummary">
                <!-- Exercise summary will be populated here -->
            </div>
            
            <div id="exerciseRecommendations" class="exercise-recommendations">
                <!-- Exercise items will be populated here -->
            </div>
            
            <div id="exerciseSchedule">
                <!-- Exercise schedule will be populated here -->
            </div>
        </div>
        
        <div id="mealplan" class="tab-content">
            <h3 class="section-title">Personalized Meal Plan</h3>
            <div id="mealPlanContainer">
                <!-- Meal plan will be populated here -->
            </div>
        </div>
    </div>
    
    <script>
        // Function to get the latest blood report from local storage
        function getLatestBloodReport() {
            const reportsString = localStorage.getItem('bloodReports');
            if (!reportsString) {
                return null;
            }
            
            const reports = JSON.parse(reportsString);
            if (!reports || reports.length === 0) {
                return null;
            }
            
            // Sort by date (newest first)
            reports.sort((a, b) => new Date(b.date) - new Date(a.date));
            return reports[0];
        }
        
        // Function to show a message when no data is available
        function showNoDataMessage() {
            document.getElementById('patientSummary').innerHTML = `
                <div class="parameter-card">
                    <h3>No Data Available</h3>
                    <p>No blood test data was found. Please upload a blood test report to receive personalized recommendations.</p>
                    <button id="uploadButton" style="background-color: var(--primary-color); color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin-top: 15px;">Upload Blood Test</button>
                </div>
            `;
            
            document.getElementById('uploadButton').addEventListener('click', function() {
                window.location.href = 'upld.html';
            });
        }
        
        // Function to send blood data to Gemini API
        async function getGeminiRecommendations(bloodData) {
            try {
                const response = await fetch('AIzaSyA5Mx9lkFnqkQR1oXYvRFAZsphAtsmtmgY', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({
        prompt: `Analyze the following blood test results and provide detailed diet and exercise recommendations:
        - Hemoglobin: ${bloodData.values.Hemoglobin} g/dL
        - Glucose: ${bloodData.values.Glucose} mg/dL
        - CRP: ${bloodData.values.CRP} mg/L
        - RBC: ${bloodData.values.RBC} million/ŒºL
        - Test Date: ${new Date(bloodData.date).toLocaleDateString()}

        Provide the response in JSON format with the following structure:
        {
            "diet": {
                "summary": "A brief summary of dietary recommendations.",
                "recommendedFoods": [
                    {"name": "Food 1", "description": "Why this is recommended.", "icon": "üçé"},
                    {"name": "Food 2", "description": "Why this is recommended.", "icon": "ü•¶"}
                ],
                "foodsToLimit": [
                    {"name": "Food 1", "description": "Why this should be limited.", "icon": "üç©"},
                    {"name": "Food 2", "description": "Why this should be limited.", "icon": "üçü"}
                ]
            },
            "exercise": {
                "summary": "A brief summary of exercise recommendations.",
                "exercises": [
                    {"name": "Exercise 1", "description": "Why this is recommended.", "duration": "20 mins", "icon": "üèÉ‚Äç‚ôÇÔ∏è"},
                    {"name": "Exercise 2", "description": "Why this is recommended.", "duration": "30 mins", "icon": "üßò‚Äç‚ôÄÔ∏è"}
                ]
            }
        }`
    })
});;
                
                if (!response.ok) {
                    throw new Error('Failed to get AI recommendations');
                }
                
                return await response.json();
            } catch (error) {
                console.error('Error getting AI recommendations:', error);
                return null;
            }
        }
        
        // Function to generate recommendations based on blood data
        async function generateRecommendations(bloodData) {
            if (!bloodData || !bloodData.values) {
                showNoDataMessage();
                return;
            }
            
            const values = bloodData.values;
            const date = new Date(bloodData.date).toLocaleDateString();
            
            // Populate patient summary
            document.getElementById('patientSummary').innerHTML = `
                <h3 class="section-title">Health Profile</h3>
                <p>Recommendations based on your blood test from ${date}</p>
                <div id="loadingIndicator">
                    <p>Generating personalized AI recommendations... <span class="spinner"></span></p>
                </div>
                <div id="abnormalParameters"></div>
            `;
            
            // Track parameters for recommendations
            const parameters = {
                lowHemoglobin: false,
                highGlucose: false,
                highCRP: false,
                lowRBC: false
            };
            
            const abnormalParamsContainer = document.getElementById('abnormalParameters');
            
            // Check hemoglobin (g/dL)
            if (values.Hemoglobin !== undefined) {
                const hemoglobin = values.Hemoglobin;
                let status = '', statusClass = '';
                
                if (hemoglobin < 12) {
                    status = 'Low';
                    statusClass = 'status-low';
                    parameters.lowHemoglobin = true;
                    
                    const elem = document.createElement('div');
                    elem.className = 'parameter-card anemia';
                    elem.innerHTML = `
                        <h3>Hemoglobin <span class="parameter-status ${statusClass}">${status}</span></h3>
                        <p>Your hemoglobin level of ${hemoglobin} g/dL is below the normal range, which may indicate anemia or low iron levels.</p>
                    `;
                    abnormalParamsContainer.appendChild(elem);
                }
            }
            
            // Check glucose (mg/dL)
            if (values.Glucose !== undefined) {
                const glucose = values.Glucose;
                let status = '', statusClass = '';
                
                if (glucose > 100) {
                    status = 'High';
                    statusClass = 'status-high';
                    parameters.highGlucose = true;
                    
                    const elem = document.createElement('div');
                    elem.className = 'parameter-card diabetes';
                    elem.innerHTML = `
                        <h3>Glucose <span class="parameter-status ${statusClass}">${status}</span></h3>
                        <p>Your glucose level of ${glucose} mg/dL is above the normal range, which may indicate prediabetes or diabetes.</p>
                    `;
                    abnormalParamsContainer.appendChild(elem);
                }
            }
            
            // Check C-Reactive Protein (mg/L)
            if (values.CRP !== undefined) {
                const crp = values.CRP;
                let status = '', statusClass = '';
                
                if (crp > 3) {
                    status = 'High';
                    statusClass = 'status-high';
                    parameters.highCRP = true;
                    
                    const elem = document.createElement('div');
                    elem.className = 'parameter-card inflammation';
                    elem.innerHTML = `
                        <h3>C-Reactive Protein <span class="parameter-status ${statusClass}">${status}</span></h3>
                        <p>Your CRP level of ${crp} mg/L is elevated, which may indicate inflammation in your body.</p>
                    `;
                    abnormalParamsContainer.appendChild(elem);
                }
            }
            
            // Check Red Blood Cell Count (millions/ŒºL)
            if (values.RBC !== undefined) {
                const rbc = values.RBC;
                let status = '', statusClass = '';
                
                if (rbc < 4.2) {
                    status = 'Low';
                    statusClass = 'status-low';
                    parameters.lowRBC = true;
                    
                    const elem = document.createElement('div');
                    elem.className = 'parameter-card anemia';
                    elem.innerHTML = `
                        <h3>Red Blood Cell Count <span class="parameter-status ${statusClass}">${status}</span></h3>
                        <p>Your RBC count of ${rbc} million/ŒºL is below the normal range, which may indicate anemia.</p>
                    `;
                    abnormalParamsContainer.appendChild(elem);
                }
            }
            
            // If no abnormal parameters, show normal message
            if (abnormalParamsContainer.children.length === 0) {
                abnormalParamsContainer.innerHTML = `
                    <div class="parameter-card">
                        <h3>Overall Health <span class="parameter-status status-normal">Normal</span></h3>
                        <p>Your blood test results appear to be within normal ranges. The following recommendations are for general health maintenance.</p>
                    </div>
                `;
            }
            
            // Get AI-powered recommendations from Gemini
            try {
                const aiRecommendations = await getGeminiRecommendations(bloodData);
                document.getElementById('loadingIndicator').style.display = 'none';
                
                if (aiRecommendations) {
                    // Generate diet recommendations with AI data
                    generateDietRecommendations(parameters, aiRecommendations.diet);
                    
                    // Generate exercise recommendations with AI data
                    generateExerciseRecommendations(parameters, aiRecommendations.exercise);
                    
                    // Generate meal plan with AI data
                    generateMealPlan(parameters, aiRecommendations.mealPlan);
                } else {
                    // Fallback to standard recommendations if AI fails
                    generateDietRecommendations(parameters);
                    generateExerciseRecommendations(parameters);
                    generateMealPlan(parameters);
                }
            } catch (error) {
                document.getElementById('loadingIndicator').style.display = 'none';
                console.error('Error with AI recommendations:', error);
                
                // Fallback to standard recommendations
                generateDietRecommendations(parameters);
                generateExerciseRecommendations(parameters);
                generateMealPlan(parameters);
            }
        }
        
        // Function to generate diet recommendations
        function generateDietRecommendations(parameters, aiRecommendations = null) {
            const dietSummary = document.getElementById('dietSummary');
            const recommendedFoods = document.getElementById('recommendedFoods');
            const limitFoods = document.getElementById('limitFoods');
            
            // If we have AI recommendations, use them
            if (aiRecommendations) {
                // Display AI-generated diet summary
                dietSummary.innerHTML = `
                    <div class="ai-recommendation">
                        <p>${aiRecommendations.summary}</p>
                    </div>
                `;
                
                // Generate recommended foods from AI
                recommendedFoods.innerHTML = '';
                aiRecommendations.recommendedFoods.forEach(food => {
                    const foodItem = document.createElement('div');
                    foodItem.className = 'food-item';
                    foodItem.innerHTML = `
                        <div class="food-icon">${food.icon || 'ü•ó'}</div>
                        <div class="food-title">${food.name}</div>
                        <div class="food-description">${food.description}</div>
                    `;
                    recommendedFoods.appendChild(foodItem);
                });
                
                // Generate foods to limit from AI
                limitFoods.innerHTML = '';
                aiRecommendations.foodsToLimit.forEach(food => {
                    const foodItem = document.createElement('div');
                    foodItem.className = 'food-item';
                    foodItem.innerHTML = `
                        <div class="food-icon">${food.icon || '‚ö†Ô∏è'}</div>
                        <div class="food-title">${food.name}</div>
                        <div class="food-description">${food.description}</div>
                    `;
                    limitFoods.appendChild(foodItem);
                });
                
                // Update nutrition guidelines
                document.getElementById('nutritionGuidelines').innerHTML = '';
                aiRecommendations.nutritionGuidelines.forEach(guideline => {
                    const li = document.createElement('li');
                    li.textContent = guideline;
                    document.getElementById('nutritionGuidelines').appendChild(li);
                });
                
                return;
            }
            
            // Fallback diet recommendations
            dietSummary.innerHTML = `
                <div class="parameter-card">
                    <h3>Dietary Focus</h3>
                    <p>${parameters.lowHemoglobin ? 'Focus on iron-rich foods to address low hemoglobin levels.' : ''}
                    ${parameters.highGlucose ? 'Reduce simple carbohydrates and focus on low glycemic index foods.' : ''}
                    ${parameters.highCRP ? 'Include anti-inflammatory foods to help reduce inflammation.' : ''}
                    ${!parameters.lowHemoglobin && !parameters.highGlucose && !parameters.highCRP ? 'Maintain a balanced diet with plenty of fruits, vegetables, lean proteins, and whole grains.' : ''}</p>
                </div>
            `;
            
            // Generate recommended foods based on parameters
            recommendedFoods.innerHTML = '';
            
            if (parameters.lowHemoglobin || parameters.lowRBC) {
                const ironFoods = [
                    {icon: 'ü•©', name: 'Lean Red Meat', description: 'High in heme iron, which is more easily absorbed by the body.'},
                    {icon: 'ü´ò', name: 'Beans & Lentils', description: 'Excellent plant-based source of iron and fiber.'},
                    {icon: 'ü•¨', name: 'Leafy Greens', description: 'Spinach and kale are rich in iron and other nutrients.'},
                    {icon: 'üçä', name: 'Vitamin C Foods', description: 'Oranges, strawberries, and bell peppers help with iron absorption.'}
                ];
                
                ironFoods.forEach(food => {
                    const foodItem = document.createElement('div');
                    foodItem.className = 'food-item';
                    foodItem.innerHTML = `
                        <div class="food-icon">${food.icon}</div>
                        <div class="food-title">${food.name}</div>
                        <div class="food-description">${food.description}</div>
                    `;
                    recommendedFoods.appendChild(foodItem);
                });
            }
            
            if (parameters.highGlucose) {
                const lowGlycemicFoods = [
                    {icon: 'ü•¶', name: 'Non-starchy Vegetables', description: 'Low in carbs and high in fiber and nutrients.'},
                    {icon: 'üçé', name: 'Low-glycemic Fruits', description: 'Berries, apples, and pears have less impact on blood sugar.'},
                    {icon: 'üêü', name: 'Fatty Fish', description: 'Salmon and mackerel are high in protein and healthy fats.'},
                    {icon: 'ü•ú', name: 'Nuts & Seeds', description: 'Provide healthy fats, protein, and fiber without raising blood sugar.'}
                ];
                
                lowGlycemicFoods.forEach(food => {
                    const foodItem = document.createElement('div');
                    foodItem.className = 'food-item';
                    foodItem.innerHTML = `
                        <div class="food-icon">${food.icon}</div>
                        <div class="food-title">${food.name}</div>
                        <div class="food-description">${food.description}</div>
                    `;
                    recommendedFoods.appendChild(foodItem);
                });
            }
            
            if (parameters.highCRP) {
                const antiInflammatoryFoods = [
                    {icon: 'üêü', name: 'Fatty Fish', description: 'Rich in omega-3 fatty acids that fight inflammation.'},
                    {icon: 'ü´í', name: 'Olive Oil', description: 'Contains oleocanthal, which has anti-inflammatory properties.'},
                    {icon: 'üçì', name: 'Berries', description: 'High in antioxidants that reduce inflammation.'},
                    {icon: 'ü•ï', name: 'Colorful Vegetables', description: 'Contain antioxidants and phytonutrients that fight inflammation.'}
                ];
                
                antiInflammatoryFoods.forEach(food => {
                    const foodItem = document.createElement('div');
                    foodItem.className = 'food-item';
                    foodItem.innerHTML = `
                        <div class="food-icon">${food.icon}</div>
                        <div class="food-title">${food.name}</div>
                        <div class="food-description">${food.description}</div>
                    `;
                    recommendedFoods.appendChild(foodItem);
                });
            }
            
            // If no specific parameters, provide general healthy foods
            if (!parameters.lowHemoglobin && !parameters.highGlucose && !parameters.highCRP && !parameters.lowRBC) {
                const healthyFoods = [
                    {icon: 'ü•ó', name: 'Leafy Greens', description: 'Rich in vitamins, minerals, and fiber.'},
                    {icon: 'üêü', name: 'Fatty Fish', description: 'High in omega-3 fatty acids and protein.'},
                    {icon: 'ü´ò', name: 'Legumes', description: 'Excellent source of plant protein and fiber.'},
                    {icon: 'ü•ú', name: 'Nuts & Seeds', description: 'Provide healthy fats, protein, and various nutrients.'},
                    {icon: 'üçé', name: 'Fruits', description: 'Rich in vitamins, antioxidants, and fiber.'},
                    {icon: 'ü•¶', name: 'Vegetables', description: 'Low in calories and high in nutrients.'}
                ];
                
                healthyFoods.forEach(food => {
                    const foodItem = document.createElement('div');
                    foodItem.className = 'food-item';
                    foodItem.innerHTML = `
                        <div class="food-icon">${food.icon}</div>
                        <div class="food-title">${food.name}</div>
                        <div class="food-description">${food.description}</div>
                    `;
                    recommendedFoods.appendChild(foodItem);
                });
            }
            
            // Generate foods to limit
            limitFoods.innerHTML = '';
            
            if (parameters.highGlucose) {
                const highGlycemicFoods = [
                    {icon: 'üç∞', name: 'Sugary Foods', description: 'Cakes, cookies, and candy can cause blood sugar spikes.'},
                    {icon: 'ü•ñ', name: 'Refined Carbs', description: 'White bread, white rice, and pasta can raise blood sugar quickly.'},
                    {icon: 'ü•§', name: 'Sugary Drinks', description: 'Soda, fruit juices, and sweetened beverages have high sugar content.'},
                    {icon: 'üçØ', name: 'Added Sugars', description: 'Honey, maple syrup, and other sweeteners should be limited.'}
                ];
                
                highGlycemicFoods.forEach(food => {
                    const foodItem = document.createElement('div');
                    foodItem.className = 'food-item';
                    foodItem.innerHTML = `
                        <div class="food-icon">${food.icon}</div>
                        <div class="food-title">${food.name}</div>
                        <div class="food-description">${food.description}</div>
                    `;
                    limitFoods.appendChild(foodItem);
                });
            }

            if (parameters.highCRP) {
                const inflammatoryFoods = [
                    {icon: 'üçü', name: 'Fried Foods', description: 'High in trans fats, which can increase inflammation.'},
                    {icon: 'üçî', name: 'Processed Meats', description: 'Sausages, bacon, and deli meats are linked to inflammation.'},
                    {icon: 'üç©', name: 'Sugary Snacks', description: 'Candies, pastries, and desserts can worsen inflammation.'},
                    {icon: 'ü•§', name: 'Sugary Drinks', description: 'Soda and energy drinks can contribute to inflammation.'}
                ];

                inflammatoryFoods.forEach(food => {
                    const foodItem = document.createElement('div');
                    foodItem.className = 'food-item';
                    foodItem.innerHTML = `
                        <div class="food-icon">${food.icon}</div>
                        <div class="food-title">${food.name}</div>
                        <div class="food-description">${food.description}</div>
                    `;
                    limitFoods.appendChild(foodItem);
                });
            }

            // If no specific parameters, provide general foods to limit
            if (!parameters.highGlucose && !parameters.highCRP) {
                const generalLimitFoods = [
                    {icon: 'üçü', name: 'Fried Foods', description: 'High in unhealthy fats and calories.'},
                    {icon: 'üçî', name: 'Processed Meats', description: 'Linked to increased health risks.'},
                    {icon: 'üç©', name: 'Sugary Snacks', description: 'High in added sugars and empty calories.'},
                    {icon: 'ü•§', name: 'Sugary Drinks', description: 'Contribute to weight gain and poor health.'}
                ];

                generalLimitFoods.forEach(food => {
                    const foodItem = document.createElement('div');
                    foodItem.className = 'food-item';
                    foodItem.innerHTML = `
                        <div class="food-icon">${food.icon}</div>
                        <div class="food-title">${food.name}</div>
                        <div class="food-description">${food.description}</div>
                    `;
                    limitFoods.appendChild(foodItem);
                });
            }

            // Update nutrition guidelines
            const guidelines = [
                'Eat a variety of fruits and vegetables daily.',
                'Choose whole grains over refined grains.',
                'Limit intake of added sugars and saturated fats.',
                'Stay hydrated by drinking plenty of water.',
                'Include lean protein sources in your diet.'
            ];

            const guidelinesList = document.getElementById('nutritionGuidelines');
            guidelinesList.innerHTML = '';
            guidelines.forEach(guideline => {
                const li = document.createElement('li');
                li.textContent = guideline;
                guidelinesList.appendChild(li);
            });
        }

        // Function to generate exercise recommendations
        function generateExerciseRecommendations(parameters, aiRecommendations = null) {
            const exerciseSummary = document.getElementById('exerciseSummary');
            const exerciseRecommendations = document.getElementById('exerciseRecommendations');

            // If we have AI recommendations, use them
            if (aiRecommendations) {
                exerciseSummary.innerHTML = `
                    <div class="ai-recommendation">
                        <p>${aiRecommendations.summary}</p>
                    </div>
                `;

                exerciseRecommendations.innerHTML = '';
                aiRecommendations.exercises.forEach(exercise => {
                    const exerciseItem = document.createElement('div');
                    exerciseItem.className = 'exercise-item';
                    exerciseItem.innerHTML = `
                        <div class="exercise-item-icon">${exercise.icon || 'üèÉ‚Äç‚ôÇÔ∏è'}</div>
                        <div class="exercise-item-content">
                            <div class="exercise-title">${exercise.name}</div>
                            <div class="exercise-description">${exercise.description}</div>
                            <div class="exercise-duration">Duration: ${exercise.duration}</div>
                        </div>
                    `;
                    exerciseRecommendations.appendChild(exerciseItem);
                });

                return;
            }

            // Fallback exercise recommendations
            exerciseSummary.innerHTML = `
                <div class="parameter-card">
                    <h3>Exercise Focus</h3>
                    <p>${parameters.lowHemoglobin ? 'Focus on low-intensity exercises to avoid fatigue.' : ''}
                    ${parameters.highGlucose ? 'Incorporate aerobic exercises to help regulate blood sugar levels.' : ''}
                    ${parameters.highCRP ? 'Include low-impact exercises to reduce inflammation.' : ''}
                    ${!parameters.lowHemoglobin && !parameters.highGlucose && !parameters.highCRP ? 'Engage in a mix of aerobic and strength-training exercises for overall health.' : ''}</p>
                </div>
            `;

            exerciseRecommendations.innerHTML = '';

            if (parameters.lowHemoglobin) {
                const exercises = [
                    {icon: 'üö∂‚Äç‚ôÄÔ∏è', name: 'Walking', description: 'Low-intensity walking for 30 minutes daily.', duration: '30 mins'},
                    {icon: 'üßò‚Äç‚ôÄÔ∏è', name: 'Yoga', description: 'Gentle yoga to improve circulation and reduce fatigue.', duration: '20-30 mins'},
                    {icon: 'üèä‚Äç‚ôÄÔ∏è', name: 'Swimming', description: 'Low-impact swimming to build endurance.', duration: '20-30 mins'}
                ];

                exercises.forEach(exercise => {
                    const exerciseItem = document.createElement('div');
                    exerciseItem.className = 'exercise-item';
                    exerciseItem.innerHTML = `
                        <div class="exercise-item-icon">${exercise.icon}</div>
                        <div class="exercise-item-content">
                            <div class="exercise-title">${exercise.name}</div>
                            <div class="exercise-description">${exercise.description}</div>
                            <div class="exercise-duration">Duration: ${exercise.duration}</div>
                        </div>
                    `;
                    exerciseRecommendations.appendChild(exerciseItem);
                });
            }

            if (parameters.highGlucose) {
                const exercises = [
                    {icon: 'üèÉ‚Äç‚ôÇÔ∏è', name: 'Running', description: 'Moderate-intensity running to improve insulin sensitivity.', duration: '20-30 mins'},
                    {icon: 'üö¥‚Äç‚ôÇÔ∏è', name: 'Cycling', description: 'Cycling at a steady pace to regulate blood sugar.', duration: '30-45 mins'},
                    {icon: 'üèãÔ∏è‚Äç‚ôÄÔ∏è', name: 'Strength Training', description: 'Weight lifting to build muscle and improve glucose metabolism.', duration: '20-30 mins'}
                ];

                exercises.forEach(exercise => {
                    const exerciseItem = document.createElement('div');
                    exerciseItem.className = 'exercise-item';
                    exerciseItem.innerHTML = `
                        <div class="exercise-item-icon">${exercise.icon}</div>
                        <div class="exercise-item-content">
                            <div class="exercise-title">${exercise.name}</div>
                            <div class="exercise-description">${exercise.description}</div>
                            <div class="exercise-duration">Duration: ${exercise.duration}</div>
                        </div>
                    `;
                    exerciseRecommendations.appendChild(exerciseItem);
                });
            }

            if (parameters.highCRP) {
                const exercises = [
                    {icon: 'üßò‚Äç‚ôÇÔ∏è', name: 'Yoga', description: 'Gentle yoga to reduce stress and inflammation.', duration: '20-30 mins'},
                    {icon: 'üö∂‚Äç‚ôÇÔ∏è', name: 'Walking', description: 'Low-impact walking to improve circulation.', duration: '30 mins'},
                    {icon: 'üèä‚Äç‚ôÇÔ∏è', name: 'Swimming', description: 'Swimming to reduce joint stress and inflammation.', duration: '20-30 mins'}
                ];

                exercises.forEach(exercise => {
                    const exerciseItem = document.createElement('div');
                    exerciseItem.className = 'exercise-item';
                    exerciseItem.innerHTML = `
                        <div class="exercise-item-icon">${exercise.icon}</div>
                        <div class="exercise-item-content">
                            <div class="exercise-title">${exercise.name}</div>
                            <div class="exercise-description">${exercise.description}</div>
                            <div class="exercise-duration">Duration: ${exercise.duration}</div>
                        </div>
                    `;
                    exerciseRecommendations.appendChild(exerciseItem);
                });
            }

            // If no specific parameters, provide general exercises
            if (!parameters.lowHemoglobin && !parameters.highGlucose && !parameters.highCRP) {
                const exercises = [
                    {icon: 'üèÉ‚Äç‚ôÄÔ∏è', name: 'Running', description: 'Moderate-intensity running for cardiovascular health.', duration: '20-30 mins'},
                    {icon: 'üèãÔ∏è‚Äç‚ôÇÔ∏è', name: 'Strength Training', description: 'Weight lifting to build muscle and strength.', duration: '20-30 mins'},
                    {icon: 'üßò‚Äç‚ôÄÔ∏è', name: 'Yoga', description: 'Yoga for flexibility and stress relief.', duration: '20-30 mins'},
                    {icon: 'üö¥‚Äç‚ôÄÔ∏è', name: 'Cycling', description: 'Cycling for endurance and leg strength.', duration: '30-45 mins'}
                ];

                exercises.forEach(exercise => {
                    const exerciseItem = document.createElement('div');
                    exerciseItem.className = 'exercise-item';
                    exerciseItem.innerHTML = `
                        <div class="exercise-item-icon">${exercise.icon}</div>
                        <div class="exercise-item-content">
                            <div class="exercise-title">${exercise.name}</div>
                            <div class="exercise-description">${exercise.description}</div>
                            <div class="exercise-duration">Duration: ${exercise.duration}</div>
                        </div>
                    `;
                    exerciseRecommendations.appendChild(exerciseItem);
                });
            }
        }

        // Function to generate a meal plan
        function generateMealPlan(parameters, aiRecommendations = null) {
            const mealPlanContainer = document.getElementById('mealPlanContainer');

            // If we have AI recommendations, use them
            if (aiRecommendations) {
                mealPlanContainer.innerHTML = `
                    <div class="ai-recommendation">
                        <p>${aiRecommendations.summary}</p>
                    </div>
                `;

                aiRecommendations.mealPlan.forEach(day => {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'meal-plan-day';
                    dayElement.innerHTML = `
                        <h4>${day.day}</h4>
                        ${day.meals.map(meal => `
                            <div class="meal-item">
                                <div class="meal-title">${meal.name}</div>
                                <div class="meal-description">${meal.description}</div>
                                <div class="meal-nutrition">Nutrition: ${meal.nutrition}</div>
                            </div>
                        `).join('')}
                    `;
                    mealPlanContainer.appendChild(dayElement);
                });

                return;
            }

            // Fallback meal plan
            mealPlanContainer.innerHTML = `
                <div class="parameter-card">
                    <h3>Meal Plan Focus</h3>
                    <p>${parameters.lowHemoglobin ? 'Include iron-rich foods in every meal.' : ''}
                    ${parameters.highGlucose ? 'Focus on low-carb, high-fiber meals.' : ''}
                    ${parameters.highCRP ? 'Incorporate anti-inflammatory foods into your diet.' : ''}
                    ${!parameters.lowHemoglobin && !parameters.highGlucose && !parameters.highCRP ? 'Follow a balanced meal plan with a mix of macronutrients.' : ''}</p>
                </div>
            `;

            const mealPlan = [
                {
                    day: 'Day 1',
                    meals: [
                        {name: 'Breakfast', description: 'Oatmeal with berries and a boiled egg.', nutrition: 'High in fiber and protein.'},
                        {name: 'Lunch', description: 'Grilled chicken salad with mixed greens and olive oil dressing.', nutrition: 'Rich in protein and healthy fats.'},
                        {name: 'Dinner', description: 'Baked salmon with quinoa and steamed broccoli.', nutrition: 'High in omega-3 and fiber.'}
                    ]
                },
                {
                    day: 'Day 2',
                    meals: [
                        {name: 'Breakfast', description: 'Greek yogurt with honey and walnuts.', nutrition: 'High in protein and healthy fats.'},
                        {name: 'Lunch', description: 'Quinoa and black bean bowl with avocado.', nutrition: 'Rich in plant protein and fiber.'},
                        {name: 'Dinner', description: 'Stir-fried tofu with vegetables and brown rice.', nutrition: 'High in protein and antioxidants.'}
                    ]
                }
            ];

            mealPlan.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'meal-plan-day';
                dayElement.innerHTML = `
                    <h4>${day.day}</h4>
                    ${day.meals.map(meal => `
                        <div class="meal-item">
                            <div class="meal-title">${meal.name}</div>
                            <div class="meal-description">${meal.description}</div>
                            <div class="meal-nutrition">Nutrition: ${meal.nutrition}</div>
                        </div>
                    `).join('')}
                `;
                mealPlanContainer.appendChild(dayElement);
            });
        }

        // Initialize on document load
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching functionality
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');

                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));

                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });

            // Go back button
            document.getElementById('goBackButton').addEventListener('click', function() {
                window.location.href = 'upld.html';
            });

            // Print button
            document.getElementById('printButton').addEventListener('click', function() {
                window.print();
            });

            // Initialize recommendations
            const latestReport = getLatestBloodReport();
            if (latestReport) {
                generateRecommendations(latestReport);
            } else {
                showNoDataMessage();
            }
        });
    </script>
</body>
</html>